<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø±ÙÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --card-bg: white;
            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #e0e0e0;
            --accent-color: #059669;
            --accent-hover: #047857;
            --body-bg: #f3f4f6;
            --feedback-card-bg: #f8f9fa;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
            --card-bg: #1f2937;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --accent-color: #10b981;
            --accent-hover: #34d399;
            --body-bg: #111827;
            --feedback-card-bg: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--bg-gradient);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Filters */
        .filters {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .filter-group select,
        .filter-group input:not([type="checkbox"]) {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: border-color 0.3s;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        /* Feedback Table */
        .feedback-container {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .feedback-grid {
            display: grid;
            gap: 20px;
        }

        .feedback-card {
            background: var(--feedback-card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .feedback-card:hover {
            border-color: var(--accent-color);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .feedback-info h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .feedback-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .category-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .category-Ù…Ø´ÙƒÙ„Ø© {
            background: #fee;
            color: #c00;
        }

        .category-ØªØ­Ø¯ÙŠØ« {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-Ø§Ù‚ØªØ±Ø§Ø­ {
            background: #fff3e0;
            color: #f57c00;
        }

        .category-Ø§Ø³ØªÙØ³Ø§Ø± {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .category-Ø£Ø®Ø±Ù‰ {
            background: #f5f5f5;
            color: #666;
        }

        .feedback-description {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
        }

        .feedback-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .status-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .status-tab {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.2s;
        }

        .status-tab.active {
            background: var(--accent-color);
            color: white;
        }

        .status-tab:hover:not(.active) {
            background: var(--feedback-card-bg);
            color: var(--accent-color);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .images-grid img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .images-grid img:hover {
            transform: scale(1.05);
        }

        .device_info {
            background: var(--body-bg);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .admin-notes {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }

        .admin-notes textarea,
        .reply-section textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin: 10px 0;
            font-family: inherit;
            background: var(--card-bg);
            color: var(--text-primary);
            resize: vertical;
        }

        .save-notes-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-notes-btn:hover {
            background: var(--accent-hover);
        }

        .delete-btn {
            background: #fee;
            color: #c00;
            border: 1px solid #c00;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #c00;
            color: white;
        }

        .reply-section {
            margin-top: 15px;
            padding: 20px;
            border-top: 1px dashed var(--border-color);
            background: var(--body-bg);
            border-radius: 15px;
        }

        .reply-section textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #059669;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            margin-bottom: 5px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: var(--accent-color);
            font-size: 1.2rem;
        }

        .error {
            background: #fee;
            color: #c00;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Modal for images */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
        }

        .modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }

        .modal.active {
            display: flex;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .filters {
                flex-direction: column;
            }

            .feedback-header {
                flex-direction: column;
            }
        }

        /* Refresh Button */
        .refresh-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: var(--accent-hover);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .refresh-btn:active {
            transform: scale(0.95);
        }

        /* Analytics Section */
        .analytics-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
            /* Hidden until data loads */
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Export Button */
        .export-btn {
            background: var(--card-bg);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        /* Auth Overlay */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .auth-card {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .auth-card h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            text-align: center;
        }

        .auth-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* Tabs Styling */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .tab {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }

        .tab.active {
            background: var(--card-bg);
            color: var(--accent-color);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Update Form Styling */
        .update-form {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .update-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .update-item {
            background: var(--feedback-card-bg);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .update-item:hover {
            border-color: var(--accent-color);
            background: var(--card-bg);
        }

        .badge-mandatory {
            background: #fee;
            color: #c00;
            border: 1px solid #ffcdd2;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .badge-optional {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ“</button>
            <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø±ÙÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
        </div>

        <div class="tabs">
            <div id="feedbackTabBtn" class="tab active" onclick="switchTab('feedback')">ğŸ“‹ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</div>
            <div id="updatesTabBtn" class="tab" onclick="switchTab('updates')">ğŸš€ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
            <div id="analyticsTabBtn" class="tab" onclick="switchTab('analytics')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
            <div id="bannersTabBtn" class="tab" onclick="switchTab('banners')">ğŸ–¼ï¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
            <div id="radioTabBtn" class="tab" onclick="switchTab('radio')">ğŸ“» Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù‚Ø±Ø¢Ù†</div>
            <div id="featuresTabBtn" class="tab" onclick="switchTab('features')">ğŸ® Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
            <div id="settingsTabBtn" class="tab" onclick="switchTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            <div id="contentTabBtn" class="tab" onclick="switchTab('content')">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
            <div id="kidsStoriesTabBtn" class="tab" onclick="switchTab('kidsStories')">ğŸ‘¶ Ù‚ØµØµ Ø±ÙƒÙ† Ø§Ù„Ø·ÙÙ„</div>
            <div id="charityStoriesTabBtn" class="tab" onclick="switchTab('charityStories')">ğŸ¤² Ù‚ØµØµ Ø§Ù„ØµØ¯Ù‚Ø§Øª</div>
            <div id="errorsTabBtn" class="tab" onclick="switchTab('errors')">âš ï¸ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„</div>
        </div>

        <div id="feedbackTab" class="tab-content active">

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon">ğŸ“</div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h3>
                    <div class="number" id="totalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon">ğŸ›</div>
                    <h3>Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</h3>
                    <div class="number" id="problemCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon">ğŸ’¡</div>
                    <h3>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h3>
                    <div class="number" id="suggestionCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon">ğŸ“…</div>
                    <h3>Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…</h3>
                    <div class="number" id="recentCount">0</div>
                </div>
            </div>

            <!-- Analytics -->
            <div id="analyticsSection" class="analytics-section">
                <h2 style="margin-bottom: 20px; color: var(--text-primary); font-size: 1.5rem;">ğŸ“Š ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="frequencyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <select id="categoryFilter">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="Ù…Ø´ÙƒÙ„Ø©" selected>Ù…Ø´ÙƒÙ„Ø©</option>
                        <option value="ØªØ­Ø¯ÙŠØ«">ØªØ­Ø¯ÙŠØ«</option>
                        <option value="Ø§Ù‚ØªØ±Ø§Ø­">Ø§Ù‚ØªØ±Ø§Ø­</option>
                        <option value="Ø§Ø³ØªÙØ³Ø§Ø±">Ø§Ø³ØªÙØ³Ø§Ø±</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="statusFilter">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                        <option value="ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©">ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                        <option value="ØªÙ… Ø§Ù„Ø­Ù„">ØªÙ… Ø§Ù„Ø­Ù„</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                    <select id="ratingFilter">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="5">â­â­â­â­â­ (5)</option>
                        <option value="4">â­â­â­â­ (4+)</option>
                        <option value="3">â­â­â­ (3+)</option>
                        <option value="2">â­â­ (2+)</option>
                        <option value="1">â­ (1+)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„ÙˆØµÙ...">
                </div>
                <div class="filter-group">
                    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="startDate">
                </div>
                <div class="filter-group">
                    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="endDate">
                </div>
                <div class="filter-group" style="min-width: 150px; display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="unrepliedFilter" onchange="filterFeedback()"
                        style="width: 20px; height: 20px; cursor: pointer;">
                    <label for="unrepliedFilter" style="margin-bottom: 0; cursor: pointer;">ğŸ“© Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø¯</label>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="refresh-btn" onclick="loadFeedback()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        <button class="export-btn" onclick="exportToCSV()">ğŸ“¥ ØªØµØ¯ÙŠØ± CSV</button>
                    </div>
                </div>
            </div>

            <!-- Feedback Container -->
            <div class="feedback-container">
                <div class="status-tabs" id="statusTabs">
                    <div class="status-tab active" onclick="setStatusFilter('', this)">Ø§Ù„ÙƒÙ„</div>
                    <div class="status-tab" onclick="setStatusFilter('Ø¬Ø¯ÙŠØ¯', this)">ğŸ†• Ø¬Ø¯ÙŠØ¯</div>
                    <div class="status-tab" onclick="setStatusFilter('ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©', this)">ğŸ“© ØªÙ… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</div>
                    <div class="status-tab" onclick="setStatusFilter('Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', this)">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
                    <div class="status-tab" onclick="setStatusFilter('ØªÙ… Ø§Ù„Ø­Ù„', this)">âœ… ØªÙ… Ø§Ù„Ø­Ù„</div>
                </div>
                <div id="feedbackList" class="feedback-grid">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                </div>
            </div>

        </div>

        <div id="updatesTab" class="tab-content">
            <div class="update-form">
                <h3 style="color: var(--accent-color); margin-bottom: 10px;">ğŸš€ Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯</h3>
                <p style="color: var(--text-secondary); margin-bottom: 25px; font-size: 0.9rem;">Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
                    Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ÙŠØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ.</p>

                <div class="update-grid">
                    <div class="filter-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± (e.g. 2.1.0)</label>
                        <input type="text" id="versionName" placeholder="Ù…Ø«Ø§Ù„: 1.0.5">
                    </div>
                    <div class="filter-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡ (Build Code)</label>
                        <input type="number" id="versionCode" placeholder="Ù…Ø«Ø§Ù„: 5">
                    </div>
                    <div class="filter-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«</label>
                        <select id="isMandatory">
                            <option value="false">Ø§Ø®ØªÙŠØ§Ø±ÙŠ (ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠÙ‡)</option>
                            <option value="true">Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠÙ‡)</option>
                        </select>
                    </div>
                </div>

                <div class="filter-group" style="margin-bottom: 20px;">
                    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ« (Direct Link / Store Link)</label>
                    <input type="text" id="updateUrl" placeholder="https://...">
                </div>

                <div class="filter-group" style="margin-bottom: 25px;">
                    <label>Ù…Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±ØŸ (Release Notes)</label>
                    <textarea id="releaseNotes"
                        style="width: 100%; height: 100px; padding: 15px; border-radius: 12px; border: 2px solid #e0e0e0; font-family: inherit;"
                        placeholder="Ù…Ø«Ø§Ù„: Ø¥ØµÙ„Ø§Ø­ Ø£Ø®Ø·Ø§Ø¡ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡..."></textarea>
                </div>

                <button class="refresh-btn" onclick="pushUpdate()"
                    style="width: 100%; height: 55px; font-size: 1.1rem;">ğŸš€ Ù†Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            </div>

            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #333;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h3>
                    <button class="refresh-btn" onclick="loadUpdates()" style="padding: 5px 15px; font-size: 0.8rem;">ğŸ”„
                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„</button>
                </div>
                <div id="updatesList">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª...</div>
                </div>
            </div>
        </div>

        <div id="analyticsTab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon">ğŸš€</div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                    <div class="number" id="totalLaunches">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon">ğŸ‘¥</div>
                    <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„ÙØ±ÙŠØ¯ÙˆÙ†</h3>
                    <div class="number" id="uniqueUsers">0</div>
                </div>
                <div class="stat-card">
                    <div class="icon">ğŸŒ</div>
                    <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆÙ„</h3>
                    <div class="number" id="countriesCount">0</div>
                </div>
            </div>

            <div class="analytics-section" style="display: block;">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">ğŸ—ºï¸ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„
                            Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹</h4>
                        <canvas id="countriesChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">ğŸ“± Ø£Ù†Ø¸Ù…Ø©
                            Ø§Ù„ØªØ´ØºÙŠÙ„</h4>
                        <canvas id="osChart"></canvas>
                    </div>
                    <div class="chart-container" style="grid-column: span 2; height: 350px;">
                        <h4 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">ğŸ¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                            Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ (Feature Analytics)</h4>
                        <canvas id="featuresUsageChart"></canvas>
                    </div>
                </div>
                <div class="chart-container" style="margin-top: 30px; height: 400px; padding-bottom: 40px;">
                    <h4 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">ğŸ“… Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ
                        (Ø¢Ø®Ø± 15 ÙŠÙˆÙ…)</h4>
                    <canvas id="dailyUsageChart"></canvas>
                </div>
            </div>
        </div>
        <!-- Feature Control Tab -->
        <div id="featuresTab" class="tab-content">
            <div class="feedback-container">
                <h3 style="margin-bottom: 25px; color: var(--text-primary);">ğŸ® Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                <p style="color: var(--text-secondary); margin-bottom: 25px; font-size: 0.9rem;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø·ÙŠÙ„ Ø£ÙŠ Ù‚Ø³Ù… ÙÙŠ
                    Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ ØµÙŠØ§Ù†Ø© Ø£Ùˆ Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ© Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;"
                    id="featuresGrid">
                    <!-- Loaded dynamically -->
                </div>
            </div>
        </div>


        <div id="settingsTab" class="tab-content">
            <div class="feedback-container">
                <h3 style="margin-bottom: 25px; color: var(--text-primary);">ğŸ› ï¸ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>

                <div class="filter-group"
                    style="margin-bottom: 30px; display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.05); padding: 20px; border-radius: 12px;">
                    <label style="margin: 0; flex: 1; color: var(--text-primary);">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© (ØªÙØ¹ÙŠÙ„ Ø³ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                        Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„)</label>
                    <input type="checkbox" id="maintenanceToggle" onchange="updateMaintenanceMode(this.checked)"
                        style="width: 25px; height: 25px; cursor: pointer;">
                </div>

                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1px dashed var(--border-color); padding: 15px; border-radius: 12px;">
                    <label
                        style="color: var(--text-primary); font-weight: bold; display: block; margin-bottom: 10px;">ğŸ“¢
                        Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ù†Ø¨Ø§Ø¡ Ø§Ù„Ù…ØªØ­Ø±Ùƒ</label>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <label style="font-size: 12px; color: var(--text-secondary);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Ù…Ø«Ù„Ø§Ù‹:
                                ØªÙ†Ø¨ÙŠÙ‡)</label>
                            <input type="text" id="newsLabelInput" placeholder="ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¬Ù„"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-top: 20px;">
                            <input type="checkbox" id="newsActiveToggle"
                                style="width: 20px; height: 20px; cursor: pointer;">
                            <label style="font-size: 13px; font-weight: bold;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¸Ù‡ÙˆØ±</label>
                        </div>
                        <div>
                            <label style="font-size: 12px; color: var(--text-secondary);">Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ø§Ù„Ù„ÙˆÙ†)</label>
                            <select id="newsTypeInput"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                                <option value="urgent">ğŸ”´ Ø¹Ø§Ø¬Ù„ (Ø£Ø­Ù…Ø±)</option>
                                <option value="info">ğŸ”µ Ù…Ø¹Ù„ÙˆÙ…Ø© (Ø£Ø²Ø±Ù‚)</option>
                                <option value="success">ğŸŸ¢ Ù†Ø¬Ø§Ø­ (Ø£Ø®Ø¶Ø±)</option>
                                <option value="warning">ğŸŸ  ØªØ­Ø°ÙŠØ± (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)</option>
                            </select>
                        </div>
                    </div>

                    <label style="font-size: 12px; color: var(--text-secondary);">Ù†Øµ Ø§Ù„Ø®Ø¨Ø± (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹
                        Ù„Ù„Ø¥Ø®ÙØ§Ø¡)</label>
                    <input type="text" id="newsInput" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..."
                        style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); margin-top: 5px;">

                    <button class="refresh-btn" onclick="updateNewsMarquee()"
                        style="margin-top: 15px; width: 100%; background: #ef4444; font-weight: bold;">ğŸ“¢ ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ·
                        Ø§Ù„Ø£Ù†Ø¨Ø§Ø¡</button>
                </div>

                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1px dashed var(--border-color); padding: 15px; border-radius: 12px; background: rgba(0,0,0,0.02);">
                    <label
                        style="color: var(--text-primary); font-weight: bold; display: block; margin-bottom: 10px;">ğŸ¨
                        Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Theme Color)</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="color" id="themeColorInput"
                            style="width: 60px; height: 40px; border: none; padding: 0; cursor: pointer; background: none;">
                        <input type="text" id="themeColorHex" placeholder="#178B74"
                            style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        <button class="refresh-btn" onclick="updateThemeColor()" style="padding: 10px 20px;">Ø­ÙØ¸
                            Ø§Ù„Ù„ÙˆÙ†</button>
                        <button class="refresh-btn" onclick="resetThemeColor()"
                            style="padding: 10px 20px; background: #6b7280;">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠ</button>
                    </div>
                    <p style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                        ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„ÙˆÙ† ÙÙˆØ±Ø§Ù‹.</p>
                </div>

                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1px solid #6366f1; padding: 20px; border-radius: 16px; background: rgba(99, 102, 241, 0.05);">
                    <div
                        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div>
                            <label style="color: #4f46e5; font-weight: bold; display: block; margin-bottom: 5px;">ğŸ“¢
                                Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© (Broadcast)</label>
                            <p style="font-size: 0.8rem; color: var(--text-secondary);">Ø±Ø³Ø§Ù„Ø© ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø¯ ÙØªØ­
                                Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª).</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label style="font-size: 12px;">ØªÙØ¹ÙŠÙ„:</label>
                            <input type="checkbox" id="broadcastToggle"
                                style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>

                    <textarea id="broadcastInput"
                        style="width: 100%; height: 80px; padding: 12px; border-radius: 12px; border: 1.5px solid #6366f1; background: var(--card-bg); color: var(--text-primary); font-family: inherit; margin-bottom: 15px;"
                        placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù‡Ù†Ø§..."></textarea>

                    <button class="refresh-btn" onclick="updateBroadcast()"
                        style="width: 100%; background: #6366f1; font-weight: bold; height: 45px;">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                        Ø§Ù„Ø¢Ù†</button>
                </div>

                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1.5px solid var(--accent-color); padding: 20px; border-radius: 16px; background: rgba(16, 185, 129, 0.05);">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <label style="color: var(--accent-color); font-weight: bold; margin: 0;">ğŸ“œ Ø®Ø§Ø·Ø±Ø© / Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…
                            (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ù‡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)</label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label style="font-size: 13px; color: var(--text-secondary);">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¸Ù‡ÙˆØ±:</label>
                            <input type="checkbox" id="quoteToggle" style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>
                    <textarea id="quoteInput"
                        style="width: 100%; height: 100px; padding: 15px; border-radius: 12px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-family: inherit;"
                        placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø®Ø§Ø·Ø±Ø© Ø£Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©..."></textarea>
                    <button class="refresh-btn" onclick="updateDailyQuote()"
                        style="margin-top: 15px; width: 100%; font-weight: bold;">ğŸ’¾ Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø§Ø·Ø±Ø©</button>
                </div>
                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1.5px solid #f59e0b; padding: 20px; border-radius: 16px; background: rgba(245, 158, 11, 0.05);">
                    <label style="color: #d97706; font-weight: bold; display: block; margin-bottom: 15px;">ğŸ”— Ø±ÙˆØ§Ø¨Ø·
                        Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù…</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 13px;">ÙÙŠØ³Ø¨ÙˆÙƒ</label>
                            <input type="text" id="linkFacebook" class="auth-input"
                                style="padding: 10px; font-size: 0.9rem; text-align: left;" dir="ltr">
                        </div>
                        <div>
                            <label style="font-size: 13px;">ÙˆØ§ØªØ³Ø§Ø¨</label>
                            <input type="text" id="linkWhatsapp" class="auth-input"
                                style="padding: 10px; font-size: 0.9rem; text-align: left;" dir="ltr">
                        </div>
                        <div>
                            <label style="font-size: 13px;">Ø±Ø§Ø¨Ø· App Store</label>
                            <input type="text" id="linkAppStore" class="auth-input"
                                style="padding: 10px; font-size: 0.9rem; text-align: left;" dir="ltr">
                        </div>
                        <div>
                            <label style="font-size: 13px;">Ø±Ø§Ø¨Ø· Play Store</label>
                            <input type="text" id="linkPlayStore" class="auth-input"
                                style="padding: 10px; font-size: 0.9rem; text-align: left;" dir="ltr">
                        </div>
                    </div>
                    <button class="refresh-btn" onclick="updateSupportLinks()"
                        style="width: 100%; background: #f59e0b; font-weight: bold; margin-top: 15px;">ğŸ’¾ Ø­ÙØ¸
                        Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
                </div>

                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1.5px solid #ec4899; padding: 20px; border-radius: 16px; background: rgba(236, 72, 153, 0.05);">
                    <label style="color: #db2777; font-weight: bold; display: block; margin-bottom: 15px;">ğŸ•‹ ØªØ¹Ø¯ÙŠÙ„
                        Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø¯Ù‚Ø§Ø¦Ù‚ +/-)</label>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„ÙØ¬Ø±</label>
                            <input type="number" id="offsetFajr" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„Ø´Ø±ÙˆÙ‚</label>
                            <input type="number" id="offsetSunrise" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„Ø¸Ù‡Ø±</label>
                            <input type="number" id="offsetDhuhr" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„Ø¹ØµØ±</label>
                            <input type="number" id="offsetAsr" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„Ù…ØºØ±Ø¨</label>
                            <input type="number" id="offsetMaghrib" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                        <div style="text-align: center;">
                            <label style="font-size: 12px; display: block;">Ø§Ù„Ø¹Ø´Ø§Ø¡</label>
                            <input type="number" id="offsetIsha" value="0"
                                style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
                        </div>
                    </div>
                    <button class="refresh-btn" onclick="updatePrayerOffsets()"
                        style="width: 100%; background: #ec4899; font-weight: bold; margin-top: 15px;">ğŸ’¾ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</button>
                    <p style="font-size: 11px; color: var(--text-secondary); margin-top: 10px; text-align: center;">Ù‡Ø°Ù‡
                        Ø§Ù„Ù‚ÙŠÙ… ØªØ¶Ø§Ù Ø£Ùˆ ØªØ®ØµÙ… Ù…Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.</p>
                </div>

                <!-- App Version Management -->
                <div class="filter-group"
                    style="margin-bottom: 30px; border: 1.5px solid #6366f1; padding: 20px; border-radius: 16px; background: rgba(99, 102, 241, 0.05);">
                    <div
                        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div>
                            <label style="color: #4f46e5; font-weight: bold; display: block; margin-bottom: 5px;">ğŸ†™
                                ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</label>
                            <p style="font-size: 0.8rem; color: var(--text-secondary);">Ø£Ù‚Ù„ Ø±Ù‚Ù… Ø¥ØµØ¯Ø§Ø± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡. Ø¥Ø°Ø§ ÙƒØ§Ù†
                                Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù‚Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø³ÙŠØ·Ù„Ø¨ Ù…Ù†Ù‡ Ø§Ù„ØªØ­Ø¯ÙŠØ«.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="minAppVersion" placeholder="Ù…Ø«Ù„Ø§Ù‹: 2.0.0"
                            style="flex: 1; padding: 12px; border-radius: 12px; border: 1.5px solid #6366f1; background: var(--card-bg); color: var(--text-primary);">
                        <button class="refresh-btn" onclick="updateMinVersion()"
                            style="background: #6366f1; font-weight: bold; height: 45px; padding: 0 25px;">ğŸ’¾
                            Ø­ÙØ¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Banners Tab -->
        <div id="bannersTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: var(--text-primary);">ğŸ–¼ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</h3>
                </div>

                <!-- Add New Banner -->
                <div class="filter-group"
                    style="padding: 20px; border: 1.5px solid var(--border-color); border-radius: 16px; margin-bottom: 30px;">
                    <h4 style="margin-top: 0; color: var(--accent-color);">âœ¨ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù†Ø± Ø¬Ø¯ÙŠØ¯</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø§Ù†Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="bannerTitle"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
                                (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="bannerLink" placeholder="https://..."
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø©</label>
                        <input type="file" id="bannerFile" accept="image/*"
                            style="display: block; width: 100%; padding: 10px; margin-top: 5px; color: var(--text-primary);">
                    </div>

                    <div id="uploadProgress"
                        style="display: none; height: 4px; background: #eee; border-radius: 2px; margin-top: 15px; overflow: hidden;">
                        <div id="progressBar"
                            style="width: 0%; height: 100%; background: var(--accent-color); transition: width 0.3s;">
                        </div>
                    </div>

                    <button class="refresh-btn" onclick="uploadBanner()"
                        style="margin-top: 20px; width: 100%; font-weight: bold;">â• Ø±ÙØ¹ Ø§Ù„Ø¨Ø§Ù†Ø± ÙˆÙ†Ø´Ø±Ù‡</button>
                </div>

                <!-- Banners List -->
                <div id="bannersList">
                    <!-- Loaded dynamically -->
                </div>
            </div>
        </div>

        <div id="contentTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: var(--text-primary);">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ (CMS)</h3>
                </div>

                <!-- Add New Content -->
                <div class="filter-group"
                    style="padding: 20px; border: 1.5px solid var(--border-color); border-radius: 16px; margin-bottom: 30px;">
                    <h4 style="margin-top: 0; color: var(--accent-color);">âœ¨ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" id="contentTitle" placeholder="Ù…Ø«Ø§Ù„: ÙØ¶Ù„ ØµÙŠØ§Ù… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ù†ÙˆØ¹</label>
                            <select id="contentType"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                                <option value="article">Ù…Ù‚Ø§Ù„ / Ø®Ø§Ø·Ø±Ø©</option>
                                <option value="tip">Ù†ØµÙŠØ­Ø© ÙŠÙˆÙ…ÙŠØ©</option>
                                <option value="announcement">Ø¥Ø¹Ù„Ø§Ù† Ù‡Ø§Ù…</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„Ù†Øµ)</label>
                        <textarea id="contentBody" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§..."
                            style="width: 100%; height: 120px; padding: 12px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-family: inherit; margin-top: 5px;"></textarea>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="contentImage" placeholder="https://..."
                            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                    </div>

                    <button class="refresh-btn" onclick="publishContent()"
                        style="margin-top: 20px; width: 100%; font-weight: bold;">ğŸ“ Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
                </div>

                <!-- Content List -->
                <div id="contentList">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</div>
                </div>
            </div>
        </div>

        <!-- Radio Tab -->
        <div id="radioTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: var(--text-primary);">ğŸ“» Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø°Ø§Ø¹Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ù…Ø®ØµØµØ©</h3>
                </div>

                <div class="filter-group"
                    style="padding: 20px; border: 1.5px solid var(--border-color); border-radius: 16px; margin-bottom: 30px; background: rgba(59, 130, 246, 0.05);">
                    <h4 style="margin-top: 0; color: #3b82f6;">âœ¨ Ø¥Ø¶Ø§ÙØ© Ø¥Ø°Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ø³Ù… Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©</label>
                            <input type="text" id="radioName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¥Ø°Ø§Ø¹Ø© ÙƒØ¨Ø§Ø± Ø§Ù„Ø¹Ù„Ù…Ø§Ø¡"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« (URL)</label>
                            <input type="text" id="radioUrl" placeholder="https://..."
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                    </div>
                    <button class="refresh-btn" onclick="addCustomRadio()"
                        style="margin-top: 15px; width: 100%; background: #3b82f6; font-weight: bold;">ğŸ’¾ Ø¥Ø¶Ø§ÙØ©
                        Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©</button>
                </div>

                <div id="radioList">
                    <!-- Radio items will load here -->
                </div>
            </div>
        </div>

        <div id="kidsStoriesTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: var(--text-primary);">ğŸ‘¶ Ø¥Ø¯Ø§Ø±Ø© Ù‚ØµØµ Ø±ÙƒÙ† Ø§Ù„Ø·ÙÙ„</h3>
                </div>

                <!-- Add New Kids Story -->
                <div class="filter-group"
                    style="padding: 20px; border: 1.5px solid var(--border-color); border-radius: 16px; margin-bottom: 30px;">
                    <h4 style="margin-top: 0; color: var(--accent-color);">âœ¨ Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„</h4>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" id="kidsStoryTitle" placeholder="Ù…Ø«Ø§Ù„: Ù‚ØµØ© Ø§Ù„ØµØ¯Ù‚"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</label>
                            <input type="text" id="kidsStoryEmoji" placeholder="ğŸ“–"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
                            <input type="number" id="kidsStoryStars" value="20"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ØµØ© (ÙÙ‚Ø±Ø§Øª - ÙƒÙ„ Ø³Ø·Ø±
                            ÙÙ‚Ø±Ø©)</label>
                        <textarea id="kidsStoryParagraphs" placeholder="Ø§ÙƒØªØ¨ ÙÙ‚Ø±Ø§Øª Ø§Ù„Ù‚ØµØ© Ù‡Ù†Ø§ØŒ ÙƒÙ„ ÙÙ‚Ø±Ø© ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯..."
                            style="width: 100%; height: 150px; padding: 12px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-family: inherit; margin-top: 5px;"></textarea>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ø­ÙƒÙ…Ø© / Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯</label>
                        <input type="text" id="kidsStoryMoral" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØµØ¯Ù‚ ÙŠÙ†Ø¬ÙŠ ØµØ§Ø­Ø¨Ù‡"
                            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                    </div>

                    <button class="refresh-btn" onclick="addKidsStory()"
                        style="margin-top: 20px; width: 100%; font-weight: bold;">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ØµØ©</button>
                </div>

                <!-- Kids Stories List -->
                <div id="kidsStoriesList">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ...</div>
                </div>
            </div>
        </div>

        <div id="charityStoriesTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: var(--text-primary);">ğŸ¤² Ø¥Ø¯Ø§Ø±Ø© Ù‚ØµØµ Ø§Ù„ØµØ¯Ù‚Ø§Øª</h3>
                </div>

                <!-- Add New Charity Story -->
                <div class="filter-group"
                    style="padding: 20px; border: 1.5px solid var(--border-color); border-radius: 16px; margin-bottom: 30px;">
                    <h4 style="margin-top: 0; color: var(--accent-color);">âœ¨ Ø¥Ø¶Ø§ÙØ© Ù‚ØµØ© ØµØ¯Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" id="charityStoryTitle" placeholder="Ù…Ø«Ø§Ù„: ÙØ¶Ù„ Ø§Ù„ØµØ¯Ù‚Ø©"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                            <select id="charityStoryCategory"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                                <option value="Ø³ÙŠØ±Ø©">Ø³ÙŠØ±Ø©</option>
                                <option value="Ø­Ø¯ÙŠØ«">Ø­Ø¯ÙŠØ«</option>
                                <option value="Ù…Ø¹Ø§ØµØ±">Ù…Ø¹Ø§ØµØ±</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 13px; color: var(--text-secondary);">Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</label>
                            <input type="text" id="charityStoryEmoji" placeholder="ğŸ’°"
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ù†Øµ Ø§Ù„Ù‚ØµØ©</label>
                        <textarea id="charityStoryContent" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ù‚ØµØ© Ù‡Ù†Ø§..."
                            style="width: 100%; height: 150px; padding: 12px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-family: inherit; margin-top: 5px;"></textarea>
                    </div>

                    <div style="margin-top: 15px;">
                        <label style="font-size: 13px; color: var(--text-secondary);">Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <input type="text" id="charityStorySource" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙˆØ§Ù‡ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ / Ù‚ØµØ© ÙˆØ§Ù‚Ø¹ÙŠØ©"
                            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary);">
                    </div>

                    <button class="refresh-btn" onclick="addCharityStory()"
                        style="margin-top: 20px; width: 100%; font-weight: bold;">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ØµØ©</button>
                </div>

                <!-- Charity Stories List -->
                <div id="charityStoriesList">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ...</div>
                </div>
            </div>
        </div>

        <div id="errorsTab" class="tab-content">
            <div class="feedback-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: var(--text-primary);">âš ï¸ Ø³Ø¬Ù„ Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                    <button class="refresh-btn" onclick="loadErrors()" style="padding: 5px 15px; font-size: 0.8rem;">ğŸ”„
                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„</button>
                </div>
                <div id="errorsList">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Overlay -->
    <div id="authOverlay" class="auth-overlay">
        <div class="auth-card">
            <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <p style="color: #666; margin-bottom: 20px;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
            <input type="password" id="authPassword" class="auth-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="auth-btn" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„</button>
            <p id="authError" style="color: #c00; margin-top: 15px; display: none;">âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal" onclick="closeModal()">
        <img id="modalImage" src="" alt="ØµÙˆØ±Ø©">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
    <!--
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://kghwboxevphvxtsagrer.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_Kl3FXiXa7AHEokVvCiImmQ_03UL91M0';

        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let allFeedback = [];
        let allUsageData = [];
        let categoryChart = null;
        let frequencyChart = null;
        let countriesChart = null;
        let osChart = null;
        let dailyUsageChart = null;
        let featuresUsageChart = null;

        function setStatusFilter(status, el) {
            document.getElementById('statusFilter').value = status;

            // Update UI
            document.querySelectorAll('.status-tab').forEach(tab => tab.classList.remove('active'));
            if (el) el.classList.add('active');

            filterFeedback();
        }

        // Toggle Theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('dashboardTheme', newTheme);
        }

        // Initialize Theme
        if (localStorage.getItem('dashboardTheme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }

        // Simple Auth Check
        function checkAuth() {
            const password = document.getElementById('authPassword').value.trim();
            const correctPassword = 'admin'; // You can change this

            if (password === correctPassword) {
                try {
                    document.getElementById('authOverlay').style.display = 'none';
                    localStorage.setItem('dashboardAuth', 'true');
                    loadFeedback();
                    loadUpdates();
                    loadAnalytics();
                    loadSettings();
                    loadErrors();
                    loadKidsStories();
                    loadCharityStories();
                } catch (e) {
                    console.error('Initial load failure:', e);
                    alert('âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + e.message);
                }
            } else {
                document.getElementById('authError').style.display = 'block';
            }
        }

        // Handle Enter key on password input
        document.getElementById('authPassword').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkAuth();
            }
        });

        // Check auth on load
        window.onload = () => {
            if (localStorage.getItem('dashboardAuth') === 'true') {
                document.getElementById('authOverlay').style.display = 'none';
                loadFeedback();
                loadUpdates();
                loadAnalytics();
                loadSettings();
                loadErrors();
                loadKidsStories();
                loadCharityStories();
            }
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            const tabEl = document.getElementById(tabName + 'Tab');
            const btnEl = document.getElementById(tabName + 'TabBtn');

            if (tabEl) tabEl.classList.add('active');
            if (btnEl) btnEl.classList.add('active');

            if (tabName === 'analytics') {
                loadAnalytics();
            } else if (tabName === 'features') {
                loadFeatures();
            } else if (tabName === 'content') {
                loadContent();
            } else if (tabName === 'kidsStories') {
                loadKidsStories();
            } else if (tabName === 'charityStories') {
                loadCharityStories();
            } else if (tabName === 'radio') {
                loadRadios();
            }
        }

        // Load feedback from Supabase
        async function loadFeedback() {
            const feedbackList = document.getElementById('feedbackList');
            feedbackList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('feedback')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allFeedback = data || [];
                updateStats();
                filterFeedback(); // Apply default filters (like category: Ù…Ø´ÙƒÙ„Ø©)
                initCharts();

                // Setup Real-time listener after first load
                setupRealtime();
            } catch (error) {
                feedbackList.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</div>`;
            }
        }

        function setupRealtime() {
            supabaseClient
                .channel('feedback_updates')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'feedback' }, payload => {
                    console.log('New feedback received!', payload);
                    allFeedback.unshift(payload.new);
                    updateStats();
                    filterFeedback(); // Rerender with current filters
                    showBrowserNotification('Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©', `ÙˆØµÙ„ØªÙƒ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${payload.new.name}`);
                })
                .subscribe();
        }

        function showBrowserNotification(title, body) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body, icon: 'https://cdn-icons-png.flaticon.com/512/3242/3242257.png' });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
        }

        // Initialize Charts
        function initCharts() {
            const analyticsSection = document.getElementById('analyticsSection');
            if (allFeedback.length === 0) {
                analyticsSection.style.display = 'none';
                return;
            }
            analyticsSection.style.display = 'block';

            // Category Chart
            const categories = {};
            allFeedback.forEach(f => {
                categories[f.category] = (categories[f.category] || 0) + 1;
            });

            if (categoryChart) categoryChart.destroy();
            const catCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(catCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª' }
                    }
                }
            });

            // Frequency Chart (Last 14 days)
            const dates = {};
            const last14Days = [...Array(14)].map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - i);
                return d.toISOString().split('T')[0];
            }).reverse();

            last14Days.forEach(d => dates[d] = 0);

            allFeedback.forEach(f => {
                const date = new Date(f.created_at).toISOString().split('T')[0];
                if (dates[date] !== undefined) dates[date]++;
            });

            if (frequencyChart) frequencyChart.destroy();
            const freqCtx = document.getElementById('frequencyChart').getContext('2d');
            frequencyChart = new Chart(freqCtx, {
                type: 'line',
                data: {
                    labels: last14Days.map(d => d.split('-').slice(1).join('/')),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰',
                        data: Object.values(dates),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙÙŠ Ø¢Ø®Ø± 14 ÙŠÙˆÙ…' }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 } }
                    }
                }
            });
        }

        // Export to CSV
        function exportToCSV() {
            if (allFeedback.length === 0) return;

            const headers = ['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ø¨Ø±ÙŠØ¯', 'Ø§Ù„ØªØµÙ†ÙŠÙ', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø¬Ù‡Ø§Ø²'];
            const rows = allFeedback.map(f => [
                f.name,
                f.email,
                f.category,
                f.description.replace(/\n/g, ' '),
                new Date(f.created_at).toLocaleString(),
                f.device_info ? `${f.device_info.model} (${f.device_info.os})` : ''
            ]);

            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOM for Excel UTF-8
            csvContent += headers.join(",") + "\n";
            rows.forEach(row => {
                csvContent += row.map(cell => `"${cell}"`).join(",") + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `feedback_report_${new Date().toLocaleDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Update feedback status
        async function updateStatus(id, newStatus) {
            try {
                const { error } = await supabaseClient
                    .from('feedback')
                    .update({ status: newStatus })
                    .eq('id', id);

                if (error) throw error;

                // Update local state
                const index = allFeedback.findIndex(f => f.id === id);
                if (index !== -1) allFeedback[index].status = newStatus;

                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù…ÙˆØ¯ status ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            }
        }

        // Save Admin Notes
        async function saveNotes(id) {
            const notes = document.getElementById(`notes-${id}`).value;
            try {
                const { error } = await supabaseClient
                    .from('feedback')
                    .update({ admin_notes: notes })
                    .eq('id', id);

                if (error) throw error;

                // Update local state
                const index = allFeedback.findIndex(f => f.id === id);
                if (index !== -1) allFeedback[index].admin_notes = notes;

                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª');
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù…ÙˆØ¯ admin_notes ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            }
        }

        // Save User Reply
        async function saveReply(id) {
            const reply = document.getElementById(`reply-${id}`).value;
            try {
                const { error } = await supabaseClient
                    .from('feedback')
                    .update({ reply: reply })
                    .eq('id', id);

                if (error) throw error;

                // Update local state
                const index = allFeedback.findIndex(f => f.id === id);
                if (index !== -1) allFeedback[index].reply = reply;

                alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù…ÙˆØ¯ reply ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            }
        }

        // Delete Feedback
        async function deleteFeedback(id) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;

            try {
                // Request select to verify deletion
                const { data, error } = await supabaseClient
                    .from('feedback')
                    .delete()
                    .eq('id', id)
                    .select();

                if (error) throw error;

                if (!data || data.length === 0) {
                    alert('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø­Ø°Ù Ø£ÙŠ Ø³Ø¬Ù„. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RLS) ÙÙŠ Supabase.');
                    return;
                }

                // Update local state and UI
                allFeedback = allFeedback.filter(f => f.id !== id);
                filterFeedback(); // Refresh the list with current filters
                updateStats();
                initCharts();

                alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                console.error(error);
                const msg = error.message || 'ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (RLS)';
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + msg);
            }
        }

        // Update statistics
        function updateStats() {
            const total = allFeedback.length;
            const problems = allFeedback.filter(f => f.category === 'Ù…Ø´ÙƒÙ„Ø©').length;
            const suggestions = allFeedback.filter(f => f.category === 'Ø§Ù‚ØªØ±Ø§Ø­').length;

            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const recent = allFeedback.filter(f => new Date(f.created_at) > sevenDaysAgo).length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('problemCount').textContent = problems;
            document.getElementById('suggestionCount').textContent = suggestions;
            document.getElementById('recentCount').textContent = recent;
        }

        // Display feedback
        function displayFeedback(feedback) {
            const feedbackList = document.getElementById('feedbackList');

            if (feedback.length === 0) {
                feedbackList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</h3>
                        <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø´ÙƒØ§ÙˆÙ‰ Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                    </div>
                `;
                return;
            }

            feedbackList.innerHTML = feedback.map(item => `
                <div class="feedback-card">
                    <div class="feedback-header">
                        <div class="feedback-info">
                            <h3>${item.name}</h3>
                            <p>ğŸ“§ ${item.email}</p>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select onchange="updateStatus('${item.id}', this.value)" style="padding: 5px; border-radius: 8px; border: 1px solid #ddd; font-size: 0.8rem;">
                                <option value="Ø¬Ø¯ÙŠØ¯" ${item.status === 'Ø¬Ø¯ÙŠØ¯' ? 'selected' : ''}>ğŸ†• Ø¬Ø¯ÙŠØ¯</option>
                                <option value="ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©" ${item.status === 'ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©' ? 'selected' : ''}>ğŸ“© ØªÙ… Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</option>
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${item.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'selected' : ''}>â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                <option value="ØªÙ… Ø§Ù„Ø­Ù„" ${item.status === 'ØªÙ… Ø§Ù„Ø­Ù„' ? 'selected' : ''}>âœ… ØªÙ… Ø§Ù„Ø­Ù„</option>
                            </select>
                            <span class="category-badge category-${item.category}">${item.category}</span>
                            <button class="delete-btn" onclick="deleteFeedback('${item.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                    
                    <div class="feedback-description">
                        ${item.description}
                    </div>

                    ${item.image_urls && item.image_urls.length > 0 ? `
                        <div class="images-grid">
                            ${item.image_urls.map(url => `
                                <img src="${url}" alt="ØµÙˆØ±Ø©" onclick="openModal('${url}')">
                            `).join('')}
                        </div>
                    ` : ''}

                    <div class="feedback-meta">
                        <div class="meta-item">
                            ğŸ“… ${new Date(item.created_at).toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })}
                        </div>
                        ${item.image_urls && item.image_urls.length > 0 ? `
                            <div class="meta-item">
                                ğŸ–¼ï¸ ${item.image_urls.length} ØµÙˆØ±Ø©
                            </div>
                        ` : ''}
                    </div>

                    ${item.device_info ? `
                        <div class="device-info">
                            <strong>ğŸ“± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong>
                            ${item.device_info.os || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'} ${item.device_info.os_version || ''} â€¢ 
                            ${item.device_info.model || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'} â€¢ 
                            Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ${item.device_info.app_version || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                        </div>
                    ` : ''}

                    <div class="admin-notes">
                        <strong>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø¯Ø§Ø®Ù„ÙŠØ©):</strong>
                        <textarea id="notes-${item.id}" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§...">${item.admin_notes || ''}</textarea>
                        <button class="save-notes-btn" onclick="saveNotes('${item.id}')">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
                    </div>

                    <div class="reply-section">
                        <strong>ğŸ’¬ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚):</strong>
                        <textarea id="reply-${item.id}" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§...">${item.reply || ''}</textarea>
                        <button class="save-notes-btn" onclick="saveReply('${item.id}')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
                    </div>
                </div>
            `).join('');
        }

        // Filter and search
        function filterFeedback() {
            const category = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;
            const rating = document.getElementById('ratingFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();
            const unrepliedOnly = document.getElementById('unrepliedFilter').checked;

            let filtered = allFeedback;

            if (unrepliedOnly) {
                filtered = filtered.filter(f => !f.reply || f.reply.trim() === '');
            }

            if (category) {
                filtered = filtered.filter(f => f.category === category);
            }

            if (status) {
                filtered = filtered.filter(f => f.status === status);
            }

            if (rating) {
                filtered = filtered.filter(f => f.rating >= parseInt(rating));
            }

            if (search) {
                filtered = filtered.filter(f =>
                    f.name.toLowerCase().includes(search) ||
                    f.email.toLowerCase().includes(search) ||
                    f.description.toLowerCase().includes(search)
                );
            }

            displayFeedback(filtered);
        }

        // Image modal
        function openModal(url) {
            document.getElementById('modalImage').src = url;
            document.getElementById('imageModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Event listeners
        document.getElementById('categoryFilter').addEventListener('change', filterFeedback);
        document.getElementById('statusFilter').addEventListener('change', filterFeedback);
        document.getElementById('ratingFilter').addEventListener('change', filterFeedback);
        document.getElementById('searchInput').addEventListener('input', filterFeedback);

        const startDateEl = document.getElementById('startDate');
        if (startDateEl) startDateEl.addEventListener('change', filterFeedback);

        const endDateEl = document.getElementById('endDate');
        if (endDateEl) endDateEl.addEventListener('change', filterFeedback);

        document.getElementById('themeColorInput').addEventListener('input', (e) => {
            document.getElementById('themeColorHex').value = e.target.value;
        });

        // Keyboard shortcut for modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Load data on page load
        // loadFeedback() is now called after auth check

        // Auto-refresh every 60 seconds (increased to avoid chart flickering)
        setInterval(() => {
            if (localStorage.getItem('dashboardAuth') === 'true') {
                loadFeedback();
                loadUpdates();
            }
        }, 60000);

        // --- NEW: APP UPDATES MANAGEMENT ---

        function switchTab(tabId) {
            console.log('Switching to tab:', tabId);
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            const content = document.getElementById(tabId + 'Tab');
            const btn = document.getElementById(tabId + 'TabBtn');

            if (content && btn) {
                content.classList.add('active');
                btn.classList.add('active');
            } else {
                console.error('Tab elements not found for:', tabId);
            }

            if (tabId === 'updates') {
                loadUpdates();
            } else if (tabId === 'analytics') {
                loadAnalytics();
            } else if (tabId === 'settings') {
                loadSettings();
            } else if (tabId === 'errors') {
                loadErrors();
            } else if (tabId === 'banners') {
                loadBanners();
            } else if (tabId === 'features') {
                loadFeatures();
            } else if (tabId === 'content') {
                loadContent();
            }
        }

        async function pushUpdate() {
            const versionName = document.getElementById('versionName').value;
            const versionCode = document.getElementById('versionCode').value;
            const isMandatory = document.getElementById('isMandatory').value === 'true';
            const updateUrl = document.getElementById('updateUrl').value;
            const releaseNotes = document.getElementById('releaseNotes').value;

            if (!versionName || !versionCode || !updateUrl) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ÙƒÙˆØ¯ØŒ Ø§Ù„Ø±Ø§Ø¨Ø·)');
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('app_updates')
                    .insert([{
                        version_name: versionName,
                        version_code: parseInt(versionCode),
                        is_mandatory: isMandatory,
                        update_url: updateUrl,
                        release_notes: releaseNotes
                    }]);

                if (error) throw error;

                alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!');
                loadUpdates();

                // Clear form
                document.getElementById('versionName').value = '';
                document.getElementById('versionCode').value = '';
                document.getElementById('updateUrl').value = '';
                document.getElementById('releaseNotes').value = '';
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ Ù†Ø´Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + error.message);
            }
        }

        async function loadUpdates() {
            try {
                console.log('Loading updates from Supabase...');
                const { data, error } = await supabaseClient
                    .from('app_updates')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                console.log('Updates loaded:', data);
                displayUpdates(data);
            } catch (error) {
                console.error('Error loading updates:', error);
                document.getElementById('updatesList').innerHTML = `<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª: ${error.message}</div>`;
            }
        }

        function displayUpdates(updates) {
            const list = document.getElementById('updatesList');
            if (updates.length === 0) {
                list.innerHTML = '<div class="empty-state">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>';
                return;
            }

            list.innerHTML = updates.map(update => `
                <div class="update-item">
                    <div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <strong style="font-size: 1.1rem; color: #059669;">V ${update.version_name}</strong>
                            <span class="badge-${update.is_mandatory ? 'mandatory' : 'optional'}">
                                ${update.is_mandatory ? 'Ø¥Ø¬Ø¨Ø§Ø±ÙŠ' : 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ'}
                            </span>
                            <span style="font-size: 0.8rem; color: #999;">(Build: ${update.version_code})</span>
                        </div>
                        <div style="font-size: 0.85rem; color: #666;">
                            ğŸ“… ${new Date(update.created_at).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: #444;">
                            ${update.release_notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="export-btn" onclick="window.open('${update.update_url}', '_blank')" style="padding: 5px 15px;">ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                        <button class="delete-btn" onclick="deleteUpdate('${update.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                </div>
            `).join('');
        }

        async function deleteUpdate(id) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø³Ø¬Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŸ Ù„Ù† ÙŠØªØ£Ø«Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆÙ„ÙƒÙ† Ø³ÙŠØ®ØªÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ù…Ù† Ù‡Ù†Ø§.')) return;
            try {
                const { data, error } = await supabaseClient
                    .from('app_updates')
                    .delete()
                    .eq('id', id)
                    .select();

                if (error) throw error;

                if (!data || data.length === 0) {
                    alert('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª DELETE Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ app_updates.');
                    return;
                }

                loadUpdates();
                alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù');
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + error.message);
            }
        }
        // --- NEW: APP ANALYTICS LOGIC ---

        async function loadAnalytics() {
            try {
                const { data, error } = await supabaseClient
                    .from('app_usage')
                    .select('*')
                    .order('created_at', { ascending: false });

                const { data: featureData, error: featureError } = await supabaseClient
                    .from('feature_usage')
                    .select('*');

                if (error) {
                    if (error.code === 'PGRST116' || error.message.includes('not found')) {
                        console.log('Analytics table not found yet.');
                        return;
                    }
                    throw error;
                }

                allUsageData = data || [];
                window.featureUsageData = featureData || [];
                displayAnalytics();
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        function displayAnalytics() {
            // 1. Basic Stats
            const total = allUsageData.length;
            const uniqueUsers = new Set(allUsageData.map(u => u.device_id)).size;
            const countries = new Set(allUsageData.map(u => u.country)).size;

            document.getElementById('totalLaunches').textContent = total;
            document.getElementById('uniqueUsers').textContent = uniqueUsers;
            document.getElementById('countriesCount').textContent = countries;

            // 2. Countries Chart
            const countryCounts = {};
            allUsageData.forEach(u => {
                const c = u.country || 'Ø£Ø®Ø±Ù‰';
                countryCounts[c] = (countryCounts[c] || 0) + 1;
            });

            const sortedCountries = Object.entries(countryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            if (countriesChart) countriesChart.destroy();
            countriesChart = new Chart(document.getElementById('countriesChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: sortedCountries.map(c => c[0]),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª',
                        data: sortedCountries.map(c => c[1]),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // 3. OS Chart
            const osCounts = {};
            allUsageData.forEach(u => {
                const os = u.os || 'Other';
                osCounts[os] = (osCounts[os] || 0) + 1;
            });

            if (osChart) osChart.destroy();
            osChart = new Chart(document.getElementById('osChart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: Object.keys(osCounts),
                    datasets: [{
                        data: Object.values(osCounts),
                        backgroundColor: ['#3b82f6', '#f59e0b', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // 4. Daily Activity Chart (Last 15 days)
            const dailyCounts = {};
            const last15Days = [...Array(15)].map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - i);
                return d.toISOString().split('T')[0];
            }).reverse();

            last15Days.forEach(date => dailyCounts[date] = 0);
            allUsageData.forEach(u => {
                const date = new Date(u.created_at).toISOString().split('T')[0];
                if (dailyCounts[date] !== undefined) {
                    dailyCounts[date]++;
                }
            });

            if (dailyUsageChart) dailyUsageChart.destroy();
            dailyUsageChart = new Chart(document.getElementById('dailyUsageChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: last15Days.map(d => d.split('-').slice(1).join('/')),
                    datasets: [{
                        label: 'Ù…Ø±Ø§Øª ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚',
                        data: last15Days.map(date => dailyCounts[date]),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 } }
                    }
                }
            });

            // 5. Feature Usage Chart
            const fCounts = {};
            APP_FEATURES.forEach(f => fCounts[f.name] = 0);

            if (window.featureUsageData) {
                window.featureUsageData.forEach(u => {
                    const feature = APP_FEATURES.find(f => f.id === u.feature_name);
                    const name = feature ? feature.name : u.feature_name;
                    fCounts[name] = (fCounts[name] || 0) + 1;
                });
            }

            if (featuresUsageChart) featuresUsageChart.destroy();
            featuresUsageChart = new Chart(document.getElementById('featuresUsageChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(fCounts),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø±Ø§Øª',
                        data: Object.values(fCounts),
                        backgroundColor: '#6366f1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        // --- NEW: APP SETTINGS & CMS LOGIC ---

        async function loadSettings() {
            try {
                const { data, error } = await supabaseClient
                    .from('app_settings')
                    .select('*');

                if (error) throw error;

                if (data) {
                    const maintenance = data.find(s => s.key === 'maintenance_mode');
                    const quote = data.find(s => s.key === 'quote_of_the_day');
                    const news = data.find(s => s.key === 'news_marquee');
                    const newsLabel = data.find(s => s.key === 'news_marquee_label');
                    const newsType = data.find(s => s.key === 'news_marquee_type');
                    const newsActive = data.find(s => s.key === 'news_active');
                    const minVersion = data.find(s => s.key === 'min_required_version');

                    const themeColor = data.find(s => s.key === 'primary_hex_color');
                    const broadcastMsg = data.find(s => s.key === 'broadcast_message');
                    const broadcastActive = data.find(s => s.key === 'broadcast_active');
                    const quoteActive = data.find(s => s.key === 'quote_active');

                    // Support Links
                    const fb = data.find(s => s.key === 'link_facebook');
                    const wa = data.find(s => s.key === 'link_whatsapp');
                    const as = data.find(s => s.key === 'link_appstore');
                    const ps = data.find(s => s.key === 'link_playstore');

                    // Prayer Offsets
                    const oFajr = data.find(s => s.key === 'prayer_offset_fajr');
                    const oSun = data.find(s => s.key === 'prayer_offset_sunrise');
                    const oDhuhr = data.find(s => s.key === 'prayer_offset_dhuhr');
                    const oAsr = data.find(s => s.key === 'prayer_offset_asr');
                    const oMag = data.find(s => s.key === 'prayer_offset_maghrib');
                    const oIsh = data.find(s => s.key === 'prayer_offset_isha');

                    if (maintenance) document.getElementById('maintenanceToggle').checked = maintenance.value === 'true';
                    if (quote) document.getElementById('quoteInput').value = quote.value;
                    if (quoteActive) document.getElementById('quoteToggle').checked = quoteActive.value === 'true';

                    if (fb) document.getElementById('linkFacebook').value = fb.value;
                    if (wa) document.getElementById('linkWhatsapp').value = wa.value;
                    if (as) document.getElementById('linkAppStore').value = as.value;
                    if (ps) document.getElementById('linkPlayStore').value = ps.value;

                    if (oFajr) document.getElementById('offsetFajr').value = oFajr.value;
                    if (oSun) document.getElementById('offsetSunrise').value = oSun.value;
                    if (oDhuhr) document.getElementById('offsetDhuhr').value = oDhuhr.value;
                    if (oAsr) document.getElementById('offsetAsr').value = oAsr.value;
                    if (oMag) document.getElementById('offsetMaghrib').value = oMag.value;
                    if (oIsh) document.getElementById('offsetIsha').value = oIsh.value;

                    if (news) document.getElementById('newsInput').value = news.value;
                    if (newsLabel) document.getElementById('newsLabelInput').value = newsLabel.value;
                    if (newsType) document.getElementById('newsTypeInput').value = newsType.value;
                    if (newsActive) document.getElementById('newsActiveToggle').checked = newsActive.value === 'true';
                    if (minVersion) document.getElementById('minAppVersion').value = minVersion.value;

                    if (themeColor) {
                        document.getElementById('themeColorInput').value = themeColor.value;
                        document.getElementById('themeColorHex').value = themeColor.value;
                    } else {
                        document.getElementById('themeColorInput').value = '#178B74';
                        document.getElementById('themeColorHex').value = '';
                    }
                    if (broadcastMsg) document.getElementById('broadcastInput').value = broadcastMsg.value;
                    if (broadcastActive) document.getElementById('broadcastToggle').checked = broadcastActive.value === 'true';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function updateThemeColor() {
            let color = document.getElementById('themeColorHex').value.trim();
            if (!color.startsWith('#')) color = '#' + color;

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert({ key: 'primary_hex_color', value: color });

                if (error) throw error;
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('themeColorInput').value = color;
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆÙ†: ' + error.message);
            }
        }

        async function resetThemeColor() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠØŸ')) return;

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .delete()
                    .eq('key', 'primary_hex_color');

                if (error) throw error;
                alert('âœ… ØªÙ… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)');
                document.getElementById('themeColorInput').value = '#178B74';
                document.getElementById('themeColorHex').value = '';
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£ØµÙ„ÙŠ: ' + error.message);
            }
        }

        async function updateBroadcast() {
            const msg = document.getElementById('broadcastInput').value;
            const active = document.getElementById('broadcastToggle').checked;
            const id = Date.now().toString(); // New ID to force pop-up for all users

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert([
                        { key: 'broadcast_message', value: msg },
                        { key: 'broadcast_active', value: active.toString() },
                        { key: 'broadcast_id', value: id }
                    ]);

                if (error) throw error;
                alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ù†Ø´Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + error.message);
            }
        }

        async function updateMaintenanceMode(isActive) {
            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert({ key: 'maintenance_mode', value: isActive.toString() });

                if (error) throw error;
                alert(`âœ… ØªÙ… ${isActive ? 'ØªÙØ¹ÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'} ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­`);
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©: ' + error.message);
            }
        }

        async function updateNewsMarquee() {
            const news = document.getElementById('newsInput').value;
            const label = document.getElementById('newsLabelInput').value;
            const type = document.getElementById('newsTypeInput').value;
            const active = document.getElementById('newsActiveToggle').checked;

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert([
                        { key: 'news_marquee', value: news },
                        { key: 'news_marquee_label', value: label },
                        { key: 'news_marquee_type', value: type },
                        { key: 'news_active', value: active.toString() }
                    ], { onConflict: 'key' });

                if (error) throw error;
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ù†Ø¨Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
                loadSettings();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ù†Ø¨Ø§Ø¡: ' + error.message);
            }
        }

        async function updateDailyQuote() {
            const quote = document.getElementById('quoteInput').value;
            const active = document.getElementById('quoteToggle').checked;
            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert([
                        { key: 'quote_of_the_day', value: quote },
                        { key: 'quote_active', value: active.toString() }
                    ]);

                if (error) throw error;
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø§Ø·Ø±Ø© ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                loadSettings();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message);
            }
        }

        async function updateSupportLinks() {
            const fb = document.getElementById('linkFacebook').value;
            const wa = document.getElementById('linkWhatsapp').value;
            const as = document.getElementById('linkAppStore').value;
            const ps = document.getElementById('linkPlayStore').value;

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert([
                        { key: 'link_facebook', value: fb },
                        { key: 'link_whatsapp', value: wa },
                        { key: 'link_appstore', value: as },
                        { key: 'link_playstore', value: ps }
                    ]);

                if (error) throw error;
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message);
            }
        }

        async function updateMinVersion() {
            const version = document.getElementById('minAppVersion').value;
            if (!version) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±');

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert({ key: 'min_required_version', value: version });

                if (error) throw error;
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ù‚Ù„ Ø¥ØµØ¯Ø§Ø± Ù…Ø·Ù„ÙˆØ¨ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + e.message);
            }
        }

        async function updatePrayerOffsets() {
            const oFajr = document.getElementById('offsetFajr').value;
            const oSun = document.getElementById('offsetSunrise').value;
            const oDhuhr = document.getElementById('offsetDhuhr').value;
            const oAsr = document.getElementById('offsetAsr').value;
            const oMag = document.getElementById('offsetMaghrib').value;
            const oIsh = document.getElementById('offsetIsha').value;

            try {
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert([
                        { key: 'prayer_offset_fajr', value: oFajr },
                        { key: 'prayer_offset_sunrise', value: oSun },
                        { key: 'prayer_offset_dhuhr', value: oDhuhr },
                        { key: 'prayer_offset_asr', value: oAsr },
                        { key: 'prayer_offset_maghrib', value: oMag },
                        { key: 'prayer_offset_isha', value: oIsh }
                    ]);

                if (error) throw error;
                alert('âœ… ØªÙ… Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message);
            }
        }

        // Radio Management
        async function loadRadios() {
            const list = document.getElementById('radioList');
            list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø§Øª...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('custom_radios')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø°Ø§Ø¹Ø§Øª Ù…Ø®ØµØµØ©</h3><p>Ø£Ø¶Ù Ø¥Ø°Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p></div>';
                    return;
                }

                list.innerHTML = data.map(r => `
                    <div class="update-item" style="border-right: 5px solid ${r.is_active ? '#3b82f6' : '#ccc'}; background: var(--card-bg);">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: var(--text-primary); text-align: right;">${r.name}</h4>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); word-break: break-all; text-align: left;" dir="ltr">ğŸ”— ${r.url}</div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-right: 20px;">
                            <button onclick="toggleRadioActive('${r.id}', ${r.is_active})" 
                                style="background: ${r.is_active ? '#10b981' : '#6b7280'}; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">
                                ${r.is_active ? 'âœ… Ù†Ø´Ø·' : 'âšª Ù…Ø¹Ø·Ù„'}
                            </button>
                            <button onclick="deleteRadio('${r.id}')" 
                                style="background: #ef4444; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                list.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${error.message}</div>`;
            }
        }

        async function addCustomRadio() {
            const name = document.getElementById('radioName').value;
            const url = document.getElementById('radioUrl').value;

            if (!name || !url) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø·');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('custom_radios')
                    .insert([{ name, url, is_active: true }]);

                if (error) throw error;

                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('radioName').value = '';
                document.getElementById('radioUrl').value = '';
                loadRadios();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message);
            }
        }

        async function toggleRadioActive(id, currentStatus) {
            try {
                const { error } = await supabaseClient
                    .from('custom_radios')
                    .update({ is_active: !currentStatus })
                    .eq('id', id);

                if (error) throw error;
                loadRadios();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©: ' + e.message);
            }
        }

        async function deleteRadio(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©ØŸ')) return;
            try {
                const { error } = await supabaseClient
                    .from('custom_radios')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                loadRadios();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + e.message);
            }
        }

        // --- NEW: ERROR LOGS LOGIC ---

        async function loadErrors() {
            const errorsList = document.getElementById('errorsList');
            errorsList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('error_logs')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    errorsList.innerHTML = '<div class="loading">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                    return;
                }

                errorsList.innerHTML = data.map(err => `
                    <div class="update-item" style="border-left: 5px solid #ff4444; position: relative;">
                        <button class="delete-btn" onclick="deleteError('${err.id}')" style="position: absolute; left: 15px; top: 15px; background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #ff4444;">ğŸ—‘ï¸</button>
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; padding-left: 30px;">
                            <div>
                                <h4 style="color: var(--text-primary); margin-bottom: 5px;">${err.message.substring(0, 100)}${err.message.length > 100 ? '...' : ''}</h4>
                                <small style="color: #888;">ğŸ“… ${new Date(err.created_at).toLocaleString('ar-EG')}</small>
                            </div>
                        </div>
                        <div style="background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-top: 10px; color: var(--text-primary);">
                            <strong>ğŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> ${err.device_info ? `${err.device_info.brand || ''} ${err.device_info.model || ''} (${err.device_info.os || ''} ${err.device_info.version || ''})` : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                            <br>
                            <strong>ğŸš€ Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${err.device_info ? err.device_info.app_version || '1.0.0' : '1.0.0'}
                        </div>
                        <div style="margin-top: 10px;">
                            <details style="cursor: pointer; color: #3b82f6;">
                                <summary>Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ (Stack Trace)</summary>
                                <pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; font-size: 0.75rem; overflow-x: auto; margin-top: 10px; text-align: left; direction: ltr;">${err.stack_trace}</pre>
                            </details>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                errorsList.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        async function deleteError(id) {
            if (!confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) return;
            try {
                const { error } = await supabaseClient
                    .from('error_logs')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                loadErrors();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + error.message);
            }
        }

        // --- NEW: BANNERS CMS LOGIC ---

        async function loadBanners() {
            const list = document.getElementById('bannersList');
            list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù†Ø±Ø§Øª...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('banners')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="no-data">â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù†Ø±Ø§Øª Ù…Ø±ÙÙˆØ¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                    return;
                }

                list.innerHTML = data.map(b => `
                    <div class="update-item" style="display: flex; gap: 20px; align-items: center; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                        <img src="${b.image_url}" style="width: 150px; height: 80px; object-fit: cover; border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: var(--text-primary);">${b.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h4>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 10px; word-break: break-all;">ğŸ”— ${b.link_url || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø·'}</div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="toggleBannerActive('${b.id}', ${b.is_active})" style="background: ${b.is_active ? '#6b7280' : 'var(--accent-color)'}; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">
                                    ${b.is_active ? 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡' : 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±'}
                                </button>
                                <button onclick="deleteBanner('${b.id}')" style="background: #ef4444; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
                list.innerHTML = '<div class="no-data">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>';
            }
        }

        async function uploadBanner() {
            const fileInput = document.getElementById('bannerFile');
            const title = document.getElementById('bannerTitle').value;
            const link = document.getElementById('bannerLink').value;
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('uploadProgress');

            if (fileInput.files.length === 0) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            const file = fileInput.files[0];
            const fileExt = file.name.split('.').pop();
            const fileName = `${Math.random().toString(36).substring(2)}_${Date.now()}.${fileExt}`;
            const filePath = `ads/${fileName}`;

            progressContainer.style.display = 'block';
            progressBar.style.width = '10%';

            try {
                // 1. Upload to Storage
                const { data: uploadData, error: uploadError } = await supabaseClient
                    .storage
                    .from('banners_storage')
                    .upload(filePath, file);

                if (uploadError) throw uploadError;
                progressBar.style.width = '60%';

                // 2. Get Public URL
                const { data: { publicUrl } } = supabaseClient
                    .storage
                    .from('banners_storage')
                    .getPublicUrl(filePath);

                // 3. Insert into Database
                const { error: dbError } = await supabaseClient
                    .from('banners')
                    .insert([{
                        title: title,
                        image_url: publicUrl,
                        link_url: link,
                        is_active: true
                    }]);

                if (dbError) throw dbError;

                progressBar.style.width = '100%';
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 1000);

                alert('âœ… ØªÙ… Ø±ÙØ¹ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¨Ø§Ù†Ø± Ø¨Ù†Ø¬Ø§Ø­');
                // Reset fields
                fileInput.value = '';
                document.getElementById('bannerTitle').value = '';
                document.getElementById('bannerLink').value = '';
                loadBanners();

            } catch (e) {
                console.error(e);
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ' + e.message);
                progressContainer.style.display = 'none';
            }
        }

        async function deleteBanner(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ù†Ø± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;

            try {
                const { error: dbError } = await supabaseClient.from('banners').delete().eq('id', id);
                if (dbError) throw dbError;
                alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
                loadBanners();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + e.message);
            }
        }

        async function toggleBannerActive(id, currentStatus) {
            try {
                const { error } = await supabaseClient
                    .from('banners')
                    .update({ is_active: !currentStatus })
                    .eq('id', id);

                if (error) throw error;
                loadBanners();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØºÙŠÙŠØ±: ' + e.message);
            }
        }

        // --- NEW: FEATURE CONTROL LOGIC ---

        const APP_FEATURES = [
            { id: 'quran', name: 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…', icon: 'ğŸ“–' },
            { id: 'azkar', name: 'Ø§Ù„Ø£Ø°ÙƒØ§Ø±', icon: 'ğŸ“¿' },
            { id: 'khatmah', name: 'Ø§Ù„Ø®ØªÙ…Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©', icon: 'ğŸ•‹' },
            { id: 'zakat', name: 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²ÙƒØ§Ø©', icon: 'ğŸ’°' },
            { id: 'charity', name: 'Ø§Ù„ØµØ¯Ù‚Ø© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©', icon: 'ğŸ¤' },
            { id: 'radio', name: 'Ø¥Ø°Ø§Ø¹Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†', icon: 'ğŸ“»' },
            { id: 'kids', name: 'Ø±ÙƒÙ† Ø§Ù„Ø£Ø·ÙØ§Ù„', icon: 'ğŸ‘¶' },
            { id: 'hadith', name: 'ÙƒØªØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«', icon: 'ğŸ“š' },
            { id: 'mosques', name: 'Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©', icon: 'ğŸ•Œ' }
        ];

        async function loadFeatures() {
            const grid = document.getElementById('featuresGrid');
            grid.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('app_settings')
                    .select('key, value')
                    .filter('key', 'like', 'section_%');

                if (error) throw error;

                grid.innerHTML = APP_FEATURES.map(feature => {
                    const settingKey = `section_${feature.id}_status`;
                    const status = data.find(s => s.key === settingKey)?.value || 'active';

                    return `
                        <div class="update-item" style="flex-direction: column; align-items: flex-start; gap: 15px;">
                            <div style="display: flex; align-items: center; gap: 12px; width: 100%;">
                                <span style="font-size: 1.5rem;">${feature.icon}</span>
                                <span style="font-weight: bold; flex: 1; color: var(--text-primary);">${feature.name}</span>
                                <span class="badge" style="background: ${status === 'active' ? '#d1fae5' : status === 'maintenance' ? '#fef3c7' : '#f3f4f6'}; color: ${status === 'active' ? '#065f46' : status === 'maintenance' ? '#92400e' : '#374151'};">
                                    ${status === 'active' ? 'Ù†Ø´Ø·' : status === 'maintenance' ? 'ØµÙŠØ§Ù†Ø©' : 'Ù…Ø®ÙÙŠ'}
                                </span>
                            </div>
                            
                            <select onchange="updateFeatureStatus('${feature.id}', this.value)" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary); cursor: pointer;">
                                <option value="active" ${status === 'active' ? 'selected' : ''}>ğŸŸ¢ Ù†Ø´Ø· (ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ)</option>
                                <option value="maintenance" ${status === 'maintenance' ? 'selected' : ''}>ğŸŸ  ØµÙŠØ§Ù†Ø© (Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…)</option>
                                <option value="hidden" ${status === 'hidden' ? 'selected' : ''}>âšª Ù…Ø®ÙÙŠ (Ø¥Ø®ÙØ§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙ…Ø§Ù…Ø§Ù‹)</option>
                            </select>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error(e);
                grid.innerHTML = '<div class="no-data">âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
            }
        }

        async function updateFeatureStatus(featureId, newStatus) {
            try {
                const key = `section_${featureId}_status`;
                const { error } = await supabaseClient
                    .from('app_settings')
                    .upsert({ key: key, value: newStatus });

                if (error) throw error;
                // Optional: show small toast instead of alert
                loadFeatures();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + e.message);
            }
        }

        // --- CONTENT MANAGEMENT (CMS) ---

        async function loadContent() {
            const list = document.getElementById('contentList');
            list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('app_content')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><h3>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰</h3><p>Ø£Ø¶Ù Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p></div>';
                    return;
                }

                list.innerHTML = data.map(item => `
                    <div class="feedback-card" style="border-left: 5px solid ${item.is_active ? '#10b981' : '#ccc'};">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h3 style="margin-bottom: 5px;">${item.title}</h3>
                                <span class="category-badge" style="background: #e0f2fe; color: #0284c7;">${item.type}</span>
                                ${!item.is_active ? '<span class="category-badge" style="background: #eee; color: #666;">ØºÙŠØ± Ù†Ø´Ø·</span>' : ''}
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="refresh-btn" onclick="toggleContentActive('${item.id}', ${item.is_active})" 
                                    style="padding: 5px 10px; font-size: 0.8rem; background: ${item.is_active ? '#6b7280' : 'var(--accent-color)'}; border: none;">
                                    ${item.is_active ? 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡' : 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±'}
                                </button>
                                <button class="delete-btn" onclick="deleteContent('${item.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p style="margin-top: 10px; color: var(--text-secondary); line-height: 1.6;">${item.body}</p>
                        ${item.image_url ? `<img src="${item.image_url}" style="margin-top: 10px; height: 100px; border-radius: 8px;">` : ''}
                        <div style="margin-top: 15px; font-size: 0.8rem; color: #aaa;">
                            ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: ${new Date(item.created_at).toLocaleDateString()}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                list.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        async function publishContent() {
            const title = document.getElementById('contentTitle').value;
            const body = document.getElementById('contentBody').value;
            const type = document.getElementById('contentType').value;
            const image = document.getElementById('contentImage').value;

            if (!title || !body) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('app_content')
                    .insert([{ title, body, type, image_url: image || null, is_active: true }]);

                if (error) throw error;

                alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!');
                document.getElementById('contentTitle').value = '';
                document.getElementById('contentBody').value = '';
                document.getElementById('contentImage').value = '';
                loadContent();
            } catch (error) {
                console.error(error);
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±: ' + error.message);
            }
        }

        async function deleteContent(id) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) return;
            try {
                const { error } = await supabaseClient.from('app_content').delete().eq('id', id);
                if (error) throw error;
                loadContent();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + e.message);
            }
        }

        async function toggleContentActive(id, currentStatus) {
            try {
                const { error } = await supabaseClient
                    .from('app_content')
                    .update({ is_active: !currentStatus })
                    .eq('id', id);

                if (error) throw error;
                loadContent();
            } catch (e) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØºÙŠÙŠØ±: ' + e.message);
            }
        }

        // --- STORIES MANAGEMENT ---

        // --- Kids Stories ---
        async function loadKidsStories() {
            const list = document.getElementById('kidsStoriesList');
            list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('kids_stories')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØµ</h3><p>Ø£Ø¶Ù Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„</p></div>';
                    return;
                }

                list.innerHTML = data.map(story => `
                    <div class="feedback-card" style="border-right: 5px solid ${story.is_visible ? 'var(--accent-color)' : '#ccc'};">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <span style="font-size: 2rem;">${story.emoji}</span>
                                <div>
                                    <h3 style="margin-bottom: 5px;">${story.title}</h3>
                                    <span class="category-badge" style="background: #fef3c7; color: #d97706;">â­ ${story.stars_reward} Ù†Ø¬Ù…Ø©</span>
                                    ${!story.is_visible ? '<span class="category-badge" style="background: #eee; color: #666;">Ù…Ø®ÙÙŠ</span>' : '<span class="category-badge" style="background: #d1fae5; color: #059669;">Ø¸Ø§Ù‡Ø±</span>'}
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="refresh-btn" onclick="toggleKidsStoryVisibility('${story.id}', ${story.is_visible})" style="padding: 5px 10px; font-size: 0.8rem; background: ${story.is_visible ? '#6b7280' : 'var(--accent-color)'};">
                                    ${story.is_visible ? 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡' : 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±'}
                                </button>
                                <button class="delete-btn" onclick="deleteKidsStory('${story.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <div style="margin-top: 15px; background: var(--card-bg); padding: 10px; border-radius: 8px;">
                            <p style="font-weight: bold; color: var(--accent-color); margin-bottom: 5px;">ÙÙ‚Ø±Ø§Øª Ø§Ù„Ù‚ØµØ©:</p>
                            <ul style="margin-right: 20px; font-size: 0.9rem; color: var(--text-secondary);">
                                ${(story.paragraphs || []).map(p => `<li>${p}</li>`).join('')}
                            </ul>
                            <p style="margin-top: 10px; font-style: italic; color: var(--text-primary);">ğŸ’¡ Ø§Ù„Ø¯Ø±Ø³: ${story.moral}</p>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                list.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ: ${error.message}</div>`;
            }
        }

        async function addKidsStory() {
            const title = document.getElementById('kidsStoryTitle').value;
            const emoji = document.getElementById('kidsStoryEmoji').value;
            const stars = parseInt(document.getElementById('kidsStoryStars').value);
            const content = document.getElementById('kidsStoryParagraphs').value;
            const moral = document.getElementById('kidsStoryMoral').value;

            if (!title || !content || !moral) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
                return;
            }

            const paragraphs = content.split('\n').map(p => p.trim()).filter(p => p.length > 0);

            try {
                const { error } = await supabaseClient
                    .from('kids_stories')
                    .insert([{ title, emoji: emoji || 'ğŸ“–', stars_reward: stars, paragraphs, moral, is_visible: true }]);

                if (error) throw error;

                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­!');
                document.getElementById('kidsStoryTitle').value = '';
                document.getElementById('kidsStoryEmoji').value = '';
                document.getElementById('kidsStoryParagraphs').value = '';
                document.getElementById('kidsStoryMoral').value = '';
                loadKidsStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message);
            }
        }

        async function toggleKidsStoryVisibility(id, currentStatus) {
            try {
                const { error } = await supabaseClient
                    .from('kids_stories')
                    .update({ is_visible: !currentStatus })
                    .eq('id', id);

                if (error) throw error;
                loadKidsStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ØªØºÙŠÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±: ' + error.message);
            }
        }

        async function deleteKidsStory(id) {
            if (!confirm('âš ï¸ Ø­Ø°Ù Ø§Ù„Ù‚ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
            try {
                const { error } = await supabaseClient.from('kids_stories').delete().eq('id', id);
                if (error) throw error;
                loadKidsStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + error.message);
            }
        }

        // --- Charity Stories ---
        async function loadCharityStories() {
            const list = document.getElementById('charityStoriesList');
            list.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ...</div>';

            try {
                const { data, error } = await supabaseClient
                    .from('charity_stories')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    list.innerHTML = '<div class="empty-state"><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØµ</h3><p>Ø£Ø¶Ù Ù‚ØµØ© ØµØ¯Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</p></div>';
                    return;
                }

                list.innerHTML = data.map(story => `
                    <div class="feedback-card" style="border-right: 5px solid ${story.is_visible ? 'var(--accent-color)' : '#ccc'};">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <span style="font-size: 2rem;">${story.emoji}</span>
                                <div>
                                    <h3 style="margin-bottom: 5px;">${story.title}</h3>
                                    <span class="category-badge" style="background: #e0f2fe; color: #0284c7;">${story.category}</span>
                                    ${!story.is_visible ? '<span class="category-badge" style="background: #eee; color: #666;">Ù…Ø®ÙÙŠ</span>' : '<span class="category-badge" style="background: #d1fae5; color: #059669;">Ø¸Ø§Ù‡Ø±</span>'}
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="refresh-btn" onclick="toggleCharityStoryVisibility('${story.id}', ${story.is_visible})" style="padding: 5px 10px; font-size: 0.8rem; background: ${story.is_visible ? '#6b7280' : 'var(--accent-color)'};">
                                    ${story.is_visible ? 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡' : 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±'}
                                </button>
                                <button class="delete-btn" onclick="deleteCharityStory('${story.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p style="margin-top: 15px; color: var(--text-primary); line-height: 1.8;">${story.content}</p>
                        <p style="margin-top: 10px; font-size: 0.85rem; color: var(--text-secondary);">ğŸ“š Ø§Ù„Ù…ØµØ¯Ø±: ${story.source}</p>
                    </div>
                `).join('');
            } catch (error) {
                list.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØµ: ${error.message}</div>`;
            }
        }

        async function addCharityStory() {
            const title = document.getElementById('charityStoryTitle').value;
            const category = document.getElementById('charityStoryCategory').value;
            const emoji = document.getElementById('charityStoryEmoji').value;
            const content = document.getElementById('charityStoryContent').value;
            const source = document.getElementById('charityStorySource').value;

            if (!title || !content || !source) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('charity_stories')
                    .insert([{ title, category, emoji: emoji || 'ğŸ¤²', content, source, is_visible: true }]);

                if (error) throw error;

                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­!');
                document.getElementById('charityStoryTitle').value = '';
                document.getElementById('charityStoryContent').value = '';
                document.getElementById('charityStorySource').value = '';
                loadCharityStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message);
            }
        }

        async function toggleCharityStoryVisibility(id, currentStatus) {
            try {
                const { error } = await supabaseClient
                    .from('charity_stori
             .update({ is_visible: !currentStatus })
                    .eq('id', id);

                if (error) throw error;
                loadCharityStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ØªØºÙŠÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±: ' + error.message);
            }
        }

        async function deleteCharityStory(id) {
            if (!confirm('âš ï¸ Ø­Ø°Ù Ø§Ù„Ù‚ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
            try {
                const { error } = await supabaseClient.from('charity_stories').delete().eq('id', id);
                if (error) throw error;
                loadCharityStories();
            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + error.message);
            }
        }
    </script>
    -->
</body>

</html>